---
description: 栈帧包括：局部变量表、操作数栈、动态连接、方法返回地址
---

# 虚拟机栈的栈帧结构

### 栈帧在哪里

前面提到JVM的运行时数据结构：方法区、堆、**虚拟机栈**、程序计数器、本地方法栈。

多个栈帧 共同组成了 虚拟机栈

### 栈帧是什么

> **栈帧\(Stack Frame\)是用于支持虚拟机进行方法调用和方法执行的数据结构。栈帧存储了方法的局部变量表、操作数栈、动态连接和方法返回地址等信息。栈帧随着方法调用而创建，随着方法结束而销毁。**

### **栈帧的组成结构**

* 局部变量表
* 操作数栈
* 动态连接
* 方法返回地址
* 附加信息

#### 1\) 局部变量表

局部变量表，用来存储方法参数，以及方法内定义的局部变量

局部变量表的基本存储单位是变量槽，一个变量槽需要能够存储32位的数据，像Java里面的long或者double，就需要用两个变量槽来存储。

#### 2）操作数栈

和局部变量表的要求一样，操作数栈也要求一个栈容量的大小可以容纳32位数据，保存64位的数据就需要两个栈容量的大小。

举个例子，例如整数加法的字节码指令`iadd`，当执行这个指令时，会把操作数栈栈顶的两个 int 值出栈并相加，然后将相加的结果重新入栈。

一个方法的执行往往伴随着许多个操作数的入栈、出栈操作。

#### 3）动态连接

 动态链接主要就是指向 **运行时常量池的方法引用**

（运行时常量池 存在于方法区，常量池里面保存的是字面量 以及 符号引用）

执行的时候将 **符号引用**  转换为直接引用，就叫做动态连接。

**4）方法返回地址**

方法在两个情况下会返回：1、正常调用完成  2、异常退出

不论方法是正常还是异常退出，在方法退出之后，程序都必须要回到方法最初被调用的位置，程序才能继续执行。

栈帧里面需要提供方法的返回信息给PC计数器，PC计数器根据地址继续执行下一条指令。

**5）附加信息**

主要是一些与调试、性能 相关的信息。



 




---
description: 5个数据区域
---

# JVM内存模型

JVM也就是Java虚拟机，一般JVM内存模型，也就是指的JVM内存结构，也就是JVM运行时数据区域，这三个问题可以等价为同一个问题。

## JVM 数据区域（5 个）

![](https://pic.downk.cc/item/5fe3f3743ffa7d37b339ac4a.jpg)

牢牢记住这个图，只有方法区和堆是**线程共享**的，其他的都是**线程私有**的。我们先从好理解的开始说起，例如程序计数器和堆栈。

### 程序计数器

* 作用：记录当前线程执行到哪里，也就是正在执行的指令的地址

程序计数器是线程私有的，因为 JVM 是支持多线程的，是通过分配 CPU 的时间片来实现多线程的轮流切换执行的，切换到下一个线程的时候，上一个线程可能还没有执行完毕，所以每个线程都需要有一个程序计数器，来**记录当前线程执行到哪里**，在下次切换到执行这条线程的时候，可以恢复到正确的执行位置。

### 堆\(区\)

![](https://pic.downk.cc/item/5fe3fc673ffa7d37b33f7c51.jpg)

从这张图就可以看出来，堆区是存放所有对象的一块区域，因为一个对象是所有线程都可以访问的，所以堆区是**线程共享**的。除了存放对象，也可以存放数组（可以理解为数组是一种特殊的对象）。垃圾回收GC也主要是在堆区进行回收的。

### 虚拟机栈

* 栈与栈帧：每个方法从执行到执行完成，对应一个栈帧在虚拟机栈中从入栈到出栈。

虚拟机栈和线程的生命周期是绑定的，线程执行完毕了，虚拟机栈也就销毁了，所以是**线程私有**的。

**什么时候会发生StackOverFlow异常？**

答：在线程请求的虚拟机栈的深度大于JVM允许的虚拟机栈的最大深度的时候，会抛出栈溢出异常。也就是线程中的栈空间不够用了。比如：死循环的递归，就会引起栈溢出异常。

#### 虚拟机栈-栈帧

一个栈帧里面包含的信息有点多：局部变量表、操作数栈、动态链接、方法返回地址、附加信息。

【参考资料】

* 书籍【深入理解 Java 虚拟机（第三版）】

